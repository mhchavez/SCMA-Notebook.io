# WORKING WITH R

**Objective:**
<ol>
  <li> Prepare data obtained from mothur to be able to work in R<li>
  <li> Analyse data by alpha and beta diversity using R </li>
 </ol>
 
## Preparing the files

In order to work in R we need to have handy (copy them from the cluster to a local directory) the following files:

<ul>
  <li> .cons.taxonomy</li>
  <li> .shared</li>
  <li> .design file</li>
</ul>

The *.design* file is not other than the metadata related to our experiment, we can prepare it in a text editor as notepad.

Once having R opened we start by calling the libraries 

      R>library(phyloseq)
      R> library(ggplot2)

Then we have to call the mothur files and giving them a name in R

      R> mothurConsTax = "~/GRAD SCHOOL/SMCA/Chipmunk/final.cons.taxonomy"
      R> mothurShared="~/GRAD SCHOOL/SMCA/Chipmunk/final.opti_mcc.shared"
 
 We will create a data object based on the taxonomy and shared files
 
      R> miseq.tax<-import_mothur(mothur_constaxonomy_file=mothurConsTax,mothur_shared_file=mothurShared)
      R> miseq.tax

<P align="center">
  <img src="~/IMAGES/R_1.jpg">
 </p>
 
 Now we will call and merge the metadata (information about our samples) with miseq.tax that have the OTUS information
 
      R> mothurMap2="~/GRAD SCHOOL/SMCA/Chipmunk/chipmunk.design2"
      R> mothurMap2=read.table(file="~/GRAD SCHOOL/SMCA/Chipmunk/chipmunk2.design",header=T)
      R> mothurMap2

<P align="center">
  <img src="~/IMAGES/R_2.jpg">
 </p>
  
      R> mothurMap2<-sample_data(mothurMap2)
      R> rownames(mothurMap2)<-mothurMap2$Sample
      R> miseq.tax.merge2<-merge_phyloseq(miseq.tax,mothurMap2)
      R> miseq.tax.merge2
  
<P align="center">
  <img src="~/IMAGES/R_3.jpg">
 </p>
 
 **Finally, we have all our files!**
 
 ## Analyzing ..

**1. Rarefying**

To start working with our data, the first step is Rarefy our data to be able to compare data that has the same "effort" (as we did in mothur)
  
    R> m.t.rare<-rarefy_even_depth(miseq.tax,sample.size=min(sample_sums(miseq.tax.merge2)))
  
  This command will rarefy to the lowest # of sequences. Lets say we have 2 samples one with 10 and other with 5 sequences, then this command will rarefy both samples to 5 sequences. In mothur we gave the command the # 74605 after checking our samples.
  
  <P align="center">
  <img src="~/IMAGES/R_4.jpg">
 </p>
 
 In this image R tell us how many sequences were removed, but to know to how much we kept we have to tell it to shows us the count
  
    R> sample_sums(*putfilenamehere*)
    
The following picture shows us the total number of sequences before and after rarefying

<P align="center">
  <img src="~/IMAGES/R_5.jpg">
 </p>
    
And we can also plot this results:

    R> plot(sample_sums(miseq.tax))

  <P align="center">
  <img src="~/IMAGES/Rplot_1.jpg"><img src="~/IMAGES/Rplot_2.jpg">
 </p>

**1. Alpha diversity Ordinations

**3. Beta diversity Ordinations

    R> m.t.rare.ord.bc<-ordinate(m.t.rare, "NMDS","bray")

